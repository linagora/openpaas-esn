version: '2'

services:

  esn:
    extends:
      file: ../docker-compose-commons.yml
      service: esn
    build: ../../../
    links:
      - redis
      - rabbitmq
      - mongo
      - sabre
      - elasticsearch
    environment:
      - PROVISION=true
      - JMAP_SERVER_HOST=jmap
      - JMAP_SERVER_PORT=80

  redis:
    extends:
      file: ../docker-compose-commons.yml
      service: redis

  rabbitmq:
    extends:
      file: ../docker-compose-commons.yml
      service: rabbitmq

  mongo:
    extends:
      file: ../docker-compose-commons.yml
      service: mongo

  elasticsearch:
    extends:
      file: ../docker-compose-commons.yml
      service: elasticsearch

  sabre:
    extends:
      file: ../docker-compose-commons.yml
      service: sabre
    links:
      - mongo

  james:
    extends:
      file: ../docker-compose-commons.yml
      service: james
    links:
      - cassandra:cassandra
      - james_elastic:elasticsearch

  james_elastic:
    extends:
      file: ../docker-compose-commons.yml
      service: james_elastic

  cassandra:
    extends:
      file: ../docker-compose-commons.yml
      service: cassandra

  selenium-grid:
    image: elgalu/selenium:2.53.0p
    container_name: selenium-grid
    privileged: true
    ports:
     - "4444:24444"
     - "5900:25900"
    environment:
      - VNC_PASSWORD=linagora
      - VIDEO=${VIDEO}
      - VIDEO_FILE_NAME=${VIDEO_FILE_NAME}
    links:
      - esn:esn_webapp
      - james:jmap
    volumes:
      - ${VIDEO_DIR}:/videos
      - /dev/shm:/dev/shm